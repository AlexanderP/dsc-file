From: Matteo F. Vescovi <m.vescovi@revese.it>
Date: Thu, 22 Dec 2011 18:17:18 +0100
Subject: locales_directory_install

Change where locales are installed
---
 source/blender/blenfont/intern/blf_lang.c |    2 +-
 source/blender/blenlib/BLI_path_util.h    |    1 +
 source/blender/blenlib/intern/path_util.c |    3 +++
 source/creator/CMakeLists.txt             |    4 ++--
 4 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/source/blender/blenfont/intern/blf_lang.c b/source/blender/blenfont/intern/blf_lang.c
index 2ba23e5..ec585af 100644
--- a/source/blender/blenfont/intern/blf_lang.c
+++ b/source/blender/blenfont/intern/blf_lang.c
@@ -101,7 +101,7 @@ static const char *locales[] = {
 
 void BLF_lang_init(void)
 {
-	char *messagepath= BLI_get_folder(BLENDER_DATAFILES, "locale");
+	char *messagepath= BLI_get_folder(BLENDER_SYSTEM_LOCALE, NULL);
 	
 	BLI_strncpy(global_encoding_name, SYSTEM_ENCODING_DEFAULT, sizeof(global_encoding_name));
 	
diff --git a/source/blender/blenlib/BLI_path_util.h b/source/blender/blenlib/BLI_path_util.h
index 68bb1a7..ba1852e 100644
--- a/source/blender/blenlib/BLI_path_util.h
+++ b/source/blender/blenlib/BLI_path_util.h
@@ -62,6 +62,7 @@ char *BLI_get_folder_version(const int id, const int ver, const int do_check);
 #define BLENDER_SYSTEM_SCRIPTS		53
 #define BLENDER_SYSTEM_PLUGINS		54
 #define BLENDER_SYSTEM_PYTHON		54
+#define BLENDER_SYSTEM_LOCALE		55
 
 /* for BLI_get_folder_version only */
 #define BLENDER_RESOURCE_PATH_USER		0
diff --git a/source/blender/blenlib/intern/path_util.c b/source/blender/blenlib/intern/path_util.c
index e79d850..383e0e8 100644
--- a/source/blender/blenlib/intern/path_util.c
+++ b/source/blender/blenlib/intern/path_util.c
@@ -1088,6 +1088,9 @@ char *BLI_get_folder(int folder_id, const char *subfolder)
 			if (get_path_local(path, "python", subfolder, ver)) break;
 			if (get_path_system(path, "python", subfolder, "BLENDER_SYSTEM_PYTHON", ver)) break;
 			return NULL;
+
+		case BLENDER_SYSTEM_LOCALE:
+			BLI_strncpy(path,"/usr/share/locale",FILE_MAX);break;
 	}
 	
 	return path;
diff --git a/source/creator/CMakeLists.txt b/source/creator/CMakeLists.txt
index 033cbf0..4f84792 100644
--- a/source/creator/CMakeLists.txt
+++ b/source/creator/CMakeLists.txt
@@ -269,9 +269,9 @@ endif()
 if(WITH_INTERNATIONAL)
 	install(
 		DIRECTORY
-			${CMAKE_SOURCE_DIR}/release/datafiles/locale
+			${CMAKE_SOURCE_DIR}/release/datafiles/locale/
 			${CMAKE_SOURCE_DIR}/release/datafiles/fonts
-		DESTINATION ${TARGETDIR_VER}/datafiles
+		DESTINATION ${CMAKE_INSTALL_PREFIX}/share/locale
 		PATTERN ".svn" EXCLUDE
 	)
 endif()
-- 
