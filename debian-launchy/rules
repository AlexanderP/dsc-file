#!/usr/bin/make -f
#export DH_VERBOSE=1

NCPUS := $(shell getconf _NPROCESSORS_ONLN 2>/dev/null || echo 1)

ifeq ($(NCPUS),-1)
	NCPUS:=1
endif

ifeq ($(NCPUS),0)
	NCPUS:=1
endif

build: build-stamp
build-stamp:
	dh_testdir
	qmake -r Launchy.pro
	$(MAKE) -j$(NCPUS)
	touch $@
clean: do-clean
do-clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp
	(test ! -f Makefile || $(MAKE) clean)
	dh_clean
install: build
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs
	find . -depth -type d -name .svn -exec echo \{\} \;
	$(MAKE) INSTALL_ROOT=$(CURDIR)/debian/launchy install
binary-indep: build install
binary-arch: build install
	dh_testdir
	dh_testroot
	dh_installdocs
	dh_installchangelogs
	dh_installdocs
	dh_installman debian/launchy.1
	mkdir $(CURDIR)/debian/launchy/usr/share/launchy/plugins
	cp -r $(CURDIR)/debian/launchy/usr/lib/launchy/plugins/icons/ $(CURDIR)/debian/launchy/usr/share/launchy/plugins/icons
	rm -rf $(CURDIR)/debian/launchy/usr/lib/launchy/plugins/icons/
	cd $(CURDIR)/debian/launchy/usr/lib/launchy/plugins/ && ln -s ../../../share/launchy/plugins/icons
	dh_strip
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_installdebconf
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install patch unpatch do-clean
