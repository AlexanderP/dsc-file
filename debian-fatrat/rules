#!/usr/bin/make -f
export DH_VERBOSE=1

#export DH_ALWAYS_EXCLUDE := LICENSE

ifneq (,$(filter lzma,$(DEB_BUILD_OPTIONS)))
	BUILDDEBFLAGS= -- -Zlzma -z9
endif

DEBIAN_CODENAME = $(shell echo $$DIST)
ifeq "$(DEBIAN_CODENAME)" ""
	DEBIAN_CODENAME = $(shell dpkg-parsechangelog | awk '/^Distribution: / {print $$2}')
endif
ifneq (,$(filter $(DEBIAN_CODENAME),squeeze lucid))
	BITTORRENT=no
else
	BITTORRENT=yes
endif

%:
	dh --parallel $@

override_dh_auto_configure:
	dh_auto_configure -- -DWITH_BITTORRENT=$(BITTORRENT) \
				 -DCMAKE_EXE_LINKER_FLAGS="-Wl,--as-needed" \
				 -DWITH_NLS=ON -DWITH_CURL=ON -DWITH_JABBER=ON \
				 -DWITH_DOCUMENTATION=ON -DWITH_WEBINTERFACE=ON
	cp $(CURDIR)/obj-$(DEB_BUILD_GNU_TYPE)/config.h $(CURDIR)/config.h

override_dh_builddeb:
	dh_builddeb $(BUILDDEBFLAGS)

